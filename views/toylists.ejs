<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: Comfortaa, sans-serif;
            color: #171717;
            box-sizing: border-box;
        }
 
        .container {
            display: flex;
            /* border: 1px solid black; */
        }
 
        .category,
        .filter,
        .popular {
            margin: 20px 85px;
            padding: 25px;
            border: 1px solid white;
            border-radius: 8px;
            width: 200px;
            box-shadow: rgba(212, 59, 59, 0.2) 0px 2px 8px 0px;
        }
 
        .dollor {
            display: flex;
            justify-content: space-between;
        }
 
        .button {
            display: flex;
            justify-content: right;
        }
 
        .btn {
            background-color: #0F83B2;
            color: white;
            border-radius: 4px;
            padding: 8px;
            border: none;
            cursor: pointer;
        }
 
        .btn:hover {
            background-color: #0d6fa1;
        }
 
        .section {
            display: flex;
            padding: 20px;
            width: 300px;
            margin: auto;
        }
 
        .main {
            border: 1px solid black;
            width: 35%;
            height: 306px;
            margin: auto;
            padding: 16px 24px;
            align-items: center;
        }
 
        .ims {
            width: 260px;
            /* border: 1px solid black; */
            padding: 8px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            border-radius: 20px;
        }
 
        .containers {
            /* border: 1px solid whitesmoke; */
            position: relative;
            width: 250px;
            height: 200px;
            /* box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px; */
            border-radius: 10px;
            display: flex;
        }
 
        .imageDiv {
            position: absolute;
            left: 3px;
            top: 4px;
            padding: 4px 8px;
            border-radius: 22px;
            background: red;
            color: whitesmoke;
            border: none;
            font-weight: 600;
            height: 30px;
            width: 65px;
        }
 
        .icons {
            position: absolute;
            top: 4px;
            right: 5px;
        }
 
        .icons i {
            margin-left: 5px;
            cursor: pointer;
        }
 
        .icons i:hover {
            color: red;
        }
 
        .h {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }
 
        .stars {
            color: orangered;
        }
 
        .right {
            width: 100%;
            margin-top: 30px;
        }
 
        .toys {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
        }
 
        .productlistimg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
 
        .unOrderList {
            list-style-type: none;
        }
 
        .unOrderList li {
            margin-bottom: 18px;
            cursor: pointer;
        }
 
        .unOrderList li:hover {
            color: red;
        }
 
        .p {
            text-decoration: line-through;
        }
 
        /* .pagination {
            display: inline-block;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-bottom: 40px;
        }
 
        .pagination a {
            color: black;
            float: left;
            padding: 11px 16px;
            text-decoration: none;
            border: 1px solid black;
            border-radius: 50%;
            margin-left: 10px;
            transition: all 0.4s ease-in-out;
        }
 
        .pagination a:hover {
            background-color: #c9e7f3;
        } */
 
 
 
 .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    gap: 10px;
    padding: 20px;
}
 
.page-link {
    color: black;
    text-decoration: none;
    font-size: 16px;
    padding: 10px 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    transition: background 0.3s ease-in-out;
}
 
.page-link:hover {
    background-color: #e0e0e0;
}
 
.active {
    background-color: #0066ff;
    color: white;
    font-weight: bold;
    border: none;
    padding: 12px 18px;
}
 
.ellipsis {
    padding: 10px;
    font-size: 16px;
    color: #777;
}
 
 
 
        .image-container {
            cursor: pointer;
        }
 
        .qr-code {
            /* border: 1px solid black; */
            height: 60px;
            width: 60px;
            /* margin: auto; */
        }
 
        .qrcode {
            height: 100%;
            width: 100%;
        }
 
        .viewDetails {
            text-decoration: none;
            /* border: 1px solid; */
            background-color: red;
            color: white;
            padding: 3px;
            border-radius: 9px;
            font-size: 13px;
        }
    </style>
 
</head>
 
<body>
    <%- include('common/navbar.ejs') %>
        <div class="container">
            <div class="left">
                <div class="category">
                    <h3>Product Categories</h3>
                    <hr>
                    <ul class="unOrderList">
                        <% allCategories.forEach(cat=> { %>
                            <li class="categoryList">
                                <%= cat %>
                            </li>
                            <% }); %>
                    </ul>
                </div>
 
                <div class="filter">
                    <h3>Filter by Price</h3>
                    <input type="range" id="vol" class="int" name="vol" min="1" max="200">
                    <div class="dollor">
                        <p id="minPrice">RS:-1.00</p>
                        <p id="selectedPrice">RS:-20.00</p>
                    </div>
                    <br>
                    <div class="button">
                        <button class="btn">Apply</button>
                    </div>
                </div>
            </div>
 
            <div class="right">
                <h2>Educational Toys</h2>
                <br>
                <div class="toys">
                    <% getAllToys?.forEach(product=> { %>
                        <div class="ims">
                            <div class="containers">
                                <div class="image-container">
                                    <% if (product.ProductImageURL) { %>
                                        <img width="100%" height="100%" class="productlistimg"
                                            src="<%= product.ProductImageURL %>" alt="<%= product.ProductName %>">
                                        <% } else { %>
                                            <img width="100%" height="100%" class="productlistimg"
                                                src="https://via.placeholder.com/200" alt="No Image Available">
                                            <% } %>
                                                <button class="imageDiv">Sale</button>
                                </div>
                                <div class="icons">
                                    <button class="addToCardBtn"> <i class="fa fa-shopping-cart"></i></button>
                                </div>
                            </div>
 
                            <div>
                                <h3>
                                    <%= product.ProductName %> <!-- Use ProductName -->
                                </h3>
                                <div class="qr-code">
                                    <!-- <img class="qrcode" src="<%= product.qrCodeUrl %>"
                                        alt="QR Code for <%= product.ProductName %>"> -->
                                    <img class="qrcode" src="data:image/png;base64,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"
                                        alt="QR Code for <%= product.ProductName %>">
                                </div>
 
                                <div class="h">
                                    <h2 style="color:green">₹<%= product.Price %>
                                    </h2> <!-- Use Price -->
                                    <h3 class="p">₹<%= product.Price + 10 %>
                                    </h3> <!-- Use Price -->
                                </div>
                                <a class="viewDetails" href="/toydetails/<%= product._id %>">View Details</a>
                                <!-- Use _id instead of id -->
                            </div>
                        </div>
                        <% }); %>
                </div>
 
                <div class="pagination">
                    <% if (currentPage > 1) { %>
                        <a class="page-link" href="/toys/alltoys?page=<%= currentPage - 1 %>&price=<%= price || '' %>&category=<%= category || '' %>">
                            &#x276E;
                        </a>
                    <% } %>
               
                    <% if (currentPage > 3) { %>
                        <a class="page-link" href="/toys/alltoys?page=1&price=<%= price || '' %>&category=<%= category || '' %>">1</a>
                        <% if (currentPage > 4) { %>
                            <span class="ellipsis">...</span>
                        <% } %>
                    <% } %>
               
                    <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                        <a href="/toys/alltoys?page=<%= i %>&price=<%= price || '' %>&category=<%= category || '' %>"
                            class="page-link <%= currentPage === i ? 'active' : '' %>">
                            <%= i %>
                        </a>
                    <% } %>
               
                    <% if (currentPage < totalPages - 2) { %>
                        <% if (currentPage < totalPages - 3) { %>
                            <span class="ellipsis">...</span>
                        <% } %>
                        <a class="page-link" href="/toys/alltoys?page=<%= totalPages %>&price=<%= price || '' %>&category=<%= category || '' %>"><%= totalPages %></a>
                    <% } %>
               
                    <% if (currentPage < totalPages) { %>
                        <a class="page-link" href="/toys/alltoys?page=<%= currentPage + 1 %>&price=<%= price || '' %>&category=<%= category || '' %>">
                            &#x276F;
                        </a>
                    <% } %>
                </div>
               
 
            </div>
        </div>
</body>
<script>
 
    const selectedPrice = document.getElementById("selectedPrice");
    const priceSlider = document.getElementById("vol");
    priceSlider.addEventListener("input", function () {
        selectedPrice.textContent = "RS:-" + this.value + ".00";
    });
    document.querySelector('.btn').addEventListener('click', () => {
        // console.log('clicked')
        let price = document.getElementById("vol").value;
        window.location.href = `/toys/alltoys?price=${price}`;
    })
 
    // work at category special
    const categoryList = document.querySelectorAll('.categoryList');
    categoryList.forEach((eachCategory, index) => {
        eachCategory.addEventListener("click", () => {
            window.location.href = `/toys/alltoys/?category=${eachCategory.innerText}`
        })
    })
 
 
    // working at pagination----
    document.querySelectorAll('.pagination a').forEach(link => {
        link.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent default link action
            const url = new URL(window.location.href);
            let selectedPage = link.textContent.trim(); // Get clicked page number
            if (selectedPage === "«") {
                selectedPage = Math.max(1, Number(url.searchParams.get("page") || 1) - 1);
            } else if (selectedPage === "»") {
                selectedPage = Number(url.searchParams.get("page") || 1) + 1;
            }
            url.searchParams.set("page", selectedPage); // Update URL with new page
            window.location.href = url.toString(); // Reload with new page
        });
    });
 
    let addToCartBtns = document.querySelectorAll('.addToCardBtn');
 
    function addToCart(event) {
        let button = event.target.closest('button'); // Ensure we get the button element
        let productBox = button.closest('.ims'); // Get the parent container
 
        let product = {
            id: productBox.querySelector('a').getAttribute('href').split('/').pop(), // Extract ID from URL
            name: productBox.querySelector('h3').textContent.trim(),
            price: productBox.querySelector('.h h2').textContent.replace('₹', '').trim(),
            imageUrl: productBox.querySelector('img').src,
            qrCodeUrl: productBox.querySelector('.qrcode').src
        };
 
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let existingProduct = cart.find(item => item.id === product.id);
 
        if (existingProduct) {
            alert('This item is already in your cart.');
            return;
        }
 
        product.quantity = 1; // Add quantity property for future updates
        cart.push(product);
        localStorage.setItem('cart', JSON.stringify(cart));
 
        alert('Item added to cart!');
        updateCartCount(); // Update the cart count display
    }
 
    function updateCartCount() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
            cartCountElement.textContent = cart.length;
        }
    }
 
    // Attach event listeners to "Add to Cart" buttons
    addToCartBtns.forEach((button) => {
        button.addEventListener('click', addToCart);
    });
 
    // Initialize cart count on page load
    document.addEventListener('DOMContentLoaded', updateCartCount);
 
</script>
 
</html>