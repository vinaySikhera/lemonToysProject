<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: Comfortaa, sans-serif;
            color: #171717;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            /* border: 1px solid black; */
        }

        .category,
        .filter,
        .popular {
            margin: 20px 85px;
            padding: 25px;
            border: 1px solid white;
            border-radius: 8px;
            width: 200px;
            box-shadow: rgba(212, 59, 59, 0.2) 0px 2px 8px 0px;
        }

        .dollor {
            display: flex;
            justify-content: space-between;
        }

        .button {
            display: flex;
            justify-content: right;
        }

        .btn {
            background-color: #0F83B2;
            color: white;
            border-radius: 4px;
            padding: 8px;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #0d6fa1;
        }

        .section {
            display: flex;
            padding: 20px;
            width: 300px;
            margin: auto;
        }

        .main {
            border: 1px solid black;
            width: 35%;
            height: 306px;
            margin: auto;
            padding: 16px 24px;
            align-items: center;
        }

        .ims {
            width: 260px;
            /* border: 1px solid black; */
            padding: 8px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            border-radius: 20px;
        }

        .containers {
            /* border: 1px solid whitesmoke; */
            position: relative;
            width: 250px;
            height: 200px;
            /* box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px; */
            border-radius: 10px;
            display: flex;
        }

        .imageDiv {
            position: absolute;
            left: 3px;
            top: 4px;
            padding: 4px 8px;
            border-radius: 22px;
            background: red;
            color: whitesmoke;
            border: none;
            font-weight: 600;
            height: 30px;
            width: 65px;
        }

        .icons {
            position: absolute;
            top: 4px;
            right: 5px;
        }

        .icons i {
            margin-left: 5px;
            cursor: pointer;
        }

        .icons i:hover {
            color: red;
        }

        .h {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }

        .stars {
            color: orangered;
        }

        .right {
            width: 100%;
            margin-top: 30px;
        }

        .toys {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
        }

        .productlistimg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .unOrderList {
            list-style-type: none;
        }

        .unOrderList li {
            margin-bottom: 18px;
            cursor: pointer;
        }

        .unOrderList li:hover {
            color: red;
        }

        .p {
            text-decoration: line-through;
        }

        .pagination {
            display: inline-block;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-bottom: 40px;
        }

        .pagination a {
            color: black;
            float: left;
            padding: 11px 16px;
            text-decoration: none;
            border: 1px solid black;
            border-radius: 50%;
            margin-left: 10px;
            transition: all 0.4s ease-in-out;
        }

        .pagination a:hover {
            background-color: #c9e7f3;
        }

        .image-container {
            cursor: pointer;
        }

        .qr-code {
            /* border: 1px solid black; */
            height: 60px;
            width: 60px;
            /* margin: auto; */
        }

        .qrcode {
            height: 100%;
            width: 100%;
        }

        .viewDetails {
            text-decoration: none;
            /* border: 1px solid; */
            background-color: red;
            color: white;
            padding: 3px;
            border-radius: 9px;
            font-size: 13px;
        }
    </style>

</head>

<body>
    <%- include('common/navbar.ejs') %>
        <div class="container">
            <div class="left">
                <div class="category">
                    <h3>Product Categories</h3>
                    <hr>
                    <ul class="unOrderList">
                        <% allCategories.forEach(cat=> { %>
                            <li class="categoryList">
                                <%= cat %>
                            </li>
                            <% }); %>
                    </ul>
                </div>

                <div class="filter">
                    <h3>Filter by Price</h3>
                    <input type="range" id="vol" class="int" name="vol" min="1" max="200">
                    <div class="dollor">
                        <p id="minPrice">RS:-1.00</p>
                        <p id="selectedPrice">RS:-20.00</p>
                    </div>
                    <br>
                    <div class="button">
                        <button class="btn">Apply</button>
                    </div>
                </div>
            </div>

            <div class="right">
                <h2>Educational Toys</h2>
                <br>
                <div class="toys">
                    <% getAllToys?.forEach(product=> { %>
                        <div class="ims">
                            <div class="containers">
                                <div class="image-container">
                                    <% if (product.imageUrl) { %>
                                        <img width="100%" height="100%" class="productlistimg"
                                            src="/<%= product.imageUrl %>" alt="<%= product.name %>">
                                        <% } else { %>
                                            <img width="100%" height="100%" class="productlistimg"
                                                src="https://via.placeholder.com/200" alt="No Image Available">
                                            <% } %>
                                                <button class="imageDiv">Sale</button>
                                </div>
                                <div class="icons">
                                    <!-- <button> <i class="fa fa-heart-o"></i></button> -->
                                    <button class="addToCardBtn"> <i class="fa fa-shopping-cart"></i></button>
                                </div>
                            </div>

                            <div>
                                <h3>
                                    <%= product.name %>
                                </h3>
                                <div class="qr-code">
                                    <img class="qrcode" src="<%= product.qrCodeUrl %>"
                                        alt="QR Code for <%= product.name %>">
                                </div>


                                <div class="h">
                                    <h2 style="color:green">₹<%= product.price %>
                                    </h2>
                                    <h3 class="p">₹<%= product.price + 10 %>
                                    </h3>
                                </div>
                                <!-- <div class="stars">
                                    <% for(let i=0; i < 5; i++) { %>
                                        <i class="fa fa-star-o"></i>
                                        <% } %>
                                </div> -->
                                <a class="viewDetails" href="/toydetails/<%= product.id %>">view details</a>
                            </div>
                        </div>
                        <% }); %>
                </div>
                <div class="pagination">
                    <% if (currentPage> 1) { %>
                        <a
                            href="/toys/alltoys?page=<%= currentPage - 1 %>&price=<%= price || '' %>&category=<%= category || '' %>">&laquo;</a>
                        <% } %>

                            <% for (let i=1; i <=totalPages; i++) { %>
                                <a href="/toys/alltoys?page=<%= i %>&price=<%= price || '' %>&category=<%= category || '' %>"
                                    class="<%= currentPage === i ? 'active' : '' %>">
                                    <%= i %>
                                </a>
                                <% } %>

                                    <% if (currentPage < totalPages) { %>
                                        <a
                                            href="/toys/alltoys?page=<%= currentPage + 1 %>&price=<%= price || '' %>&category=<%= category || '' %>">&raquo;</a>
                                        <% } %>
                </div>

            </div>
        </div>
</body>
<script>

    const selectedPrice = document.getElementById("selectedPrice");
    const priceSlider = document.getElementById("vol");
    priceSlider.addEventListener("input", function () {
        selectedPrice.textContent = "RS:-" + this.value + ".00";
    });
    document.querySelector('.btn').addEventListener('click', () => {
        console.log('clicked')
        let price = document.getElementById("vol").value;
        window.location.href = `/toys/alltoys?price=${price}`;
    })

    // work at category special
    const categoryList = document.querySelectorAll('.categoryList');
    categoryList.forEach((eachCategory, index) => {
        eachCategory.addEventListener("click", () => {
            window.location.href = `/toys/alltoys/?category=${eachCategory.innerText}`
        })
    })


    // working at pagination----
    document.querySelectorAll('.pagination a').forEach(link => {
        link.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent default link action
            const url = new URL(window.location.href);
            let selectedPage = link.textContent.trim(); // Get clicked page number
            if (selectedPage === "«") {
                selectedPage = Math.max(1, Number(url.searchParams.get("page") || 1) - 1);
            } else if (selectedPage === "»") {
                selectedPage = Number(url.searchParams.get("page") || 1) + 1;
            }
            url.searchParams.set("page", selectedPage); // Update URL with new page
            window.location.href = url.toString(); // Reload with new page
        });
    });

    let addToCartBtns = document.querySelectorAll('.addToCardBtn');

    function addToCart(event) {
        let button = event.target.closest('button'); // Ensure we get the button element
        let productBox = button.closest('.ims'); // Get the parent container

        let product = {
            id: productBox.querySelector('a').getAttribute('href').split('/').pop(), // Extract ID from URL
            name: productBox.querySelector('h3').textContent.trim(),
            price: productBox.querySelector('.h h2').textContent.replace('₹', '').trim(),
            imageUrl: productBox.querySelector('img').src,
            qrCodeUrl: productBox.querySelector('.qrcode').src
        };

        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let existingProduct = cart.find(item => item.id === product.id);

        if (existingProduct) {
            alert('This item is already in your cart.');
            return;
        }

        product.quantity = 1; // Add quantity property for future updates
        cart.push(product);
        localStorage.setItem('cart', JSON.stringify(cart));

        alert('Item added to cart!');
        updateCartCount(); // Update the cart count display
    }

    function updateCartCount() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
            cartCountElement.textContent = cart.length;
        }
    }

    // Attach event listeners to "Add to Cart" buttons
    addToCartBtns.forEach((button) => {
        button.addEventListener('click', addToCart);
    });

    // Initialize cart count on page load
    document.addEventListener('DOMContentLoaded', updateCartCount);

</script>

</html>